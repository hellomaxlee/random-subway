<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Random NYC Subway Stop Picker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 2rem; }
    h1 { margin-bottom: 0.25rem; }
    .wrap { max-width: 700px; }
    .controls { display: flex; gap: .75rem; align-items: center; margin: 1rem 0; flex-wrap: wrap; }
    select, button { font-size: 1rem; padding: .6rem .8rem; border-radius: .6rem; border: 1px solid #ccc; }
    button { cursor: pointer; }
    .card { border: 1px solid #e6e6e6; border-radius: 1rem; padding: 1rem; box-shadow: 0 2px 10px rgba(0,0,0,.04); }
    .muted { color: #666; }
    .small { font-size: .9rem; }
    .lines { display: inline-flex; gap: .35rem; flex-wrap: wrap; margin-left: .25rem; vertical-align: middle; }
    .pill { padding: .2rem .5rem; border-radius: .75rem; border: 1px solid #ddd; font-weight: 600; }
    .footer { margin-top: 1rem; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>üé≤ Random NYC Subway Stop</h1>
    <div class="muted small">Data: NY Open Data ‚ÄúMTA Subway Stations &amp; Complexes‚Äù</div>

    <div class="controls">
      <label for="borough">Borough:</label>
      <select id="borough">
        <option value="">Any</option>
        <option>Manhattan</option>
        <option>Brooklyn</option>
        <option>Queens</option>
        <option>Bronx</option>
        <option>Staten Island</option>
      </select>
      <button id="pickBtn">Pick a station</button>
    </div>

    <div id="result" class="card muted">Click ‚ÄúPick a station‚Äù to start.</div>

    <div class="footer small muted">
      Tip: Click repeatedly to reroll. Filtering is client-side for speed.
    </div>
  </div>

  <script>
    // Dataset: https://data.ny.gov/Transportation/MTA-Subway-Stations-and-Complexes/5f5g-n3cz
    // API (Socrata): https://data.ny.gov/resource/5f5g-n3cz.json
    const ENDPOINT = 'https://data.ny.gov/resource/5f5g-n3cz.json?$limit=5000';

    let stations = [];
    const boroughSelect = document.getElementById('borough');
    const resultEl = document.getElementById('result');
    const btn = document.getElementById('pickBtn');

    function pickRandom(list) {
      return list[Math.floor(Math.random() * list.length)];
    }

    function renderStation(s) {
      // Try a few likely field names defensively
      const name = s.complex_name || s.station_name || s.stop_name || s.name || 'Unknown';
      const borough = s.borough || s.city || '‚Äî';
      const lat = parseFloat(s.latitude || (s.location && s.location.latitude) || s.the_geom?.coordinates?.[1] || s.lat || s.y || NaN);
      const lon = parseFloat(s.longitude || (s.location && s.location.longitude) || s.the_geom?.coordinates?.[0] || s.lon || s.x || NaN);

      // Services/lines field varies; try common ones
      const servicesRaw = s.services || s.lines || s.transfers || s.routes || '';
      // Normalize to array of distinct line bullets
      const lines = Array.isArray(servicesRaw)
        ? servicesRaw
        : (typeof servicesRaw === 'string' ? servicesRaw.split(/[,\s/]+/).filter(Boolean) : []);

      const mapsHref = (!isNaN(lat) && !isNaN(lon))
        ? `https://www.google.com/maps?q=${lat},${lon} (${encodeURIComponent(name)})`
        : `https://www.google.com/maps/search/${encodeURIComponent(name + ' subway station NYC')}`;

      resultEl.innerHTML = `
        <div>
          <div class="small muted">Borough</div>
          <div><strong>${borough}</strong></div>
        </div>
        <div style="height:.75rem"></div>
        <div class="small muted">Station / Complex</div>
        <div style="font-size:1.25rem; font-weight:700; line-height:1.3">${name}</div>
        <div style="height:.5rem"></div>
        <div class="small muted">Lines</div>
        <div class="lines">${lines.length ? lines.map(l => `<span class="pill">${l}</span>`).join('') : '<span class="muted">‚Äî</span>'}</div>
        <div style="height:.75rem"></div>
        <a href="${mapsHref}" target="_blank" rel="noopener">Open in Google Maps ‚Üó</a>
      `;
    }

    async function loadStations() {
      resultEl.textContent = 'Loading stations‚Ä¶';
      try {
        const res = await fetch(ENDPOINT);
        if (!res.ok) throw new Error(res.status + ' ' + res.statusText);
        const data = await res.json();

        // Keep only items that look like subway stations (dataset also includes SIR)
        stations = data.filter(s => {
          const borough = (s.borough || '').toLowerCase();
          const name = (s.complex_name || s.station_name || s.name || '').toLowerCase();
          // We‚Äôll treat Staten Island as SIR and leave it opt-in via borough filter
          // Everything else passes.
          return name && (!borough || ['manhattan','brooklyn','queens','bronx','staten island'].includes(borough));
        });

        resultEl.textContent = `Loaded ${stations.length} stations. Pick one!`;
      } catch (e) {
        console.error(e);
        resultEl.innerHTML = 'Failed to load stations. Are you offline?';
      }
    }

    function pickAndShow() {
      if (!stations.length) return;
      const b = boroughSelect.value;
      const pool = b ? stations.filter(s => (s.borough || '').toLowerCase() === b.toLowerCase()) : stations;
      if (!pool.length) {
        resultEl.textContent = `No stations found for borough: ${b}`;
        return;
      }
      renderStation(pickRandom(pool));
    }

    btn.addEventListener('click', pickAndShow);
    loadStations();
  </script>
</body>
</html>
